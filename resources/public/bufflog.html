<html>
<head>
  <style type="text/css">
  .space {
    font-family: monospace;
    height: 100%;
    float: left;
  }
  .editable {
    background: #eee;
  }
  #input {
    width: 15%;
  }
  #processed {
    width: 40%;
  }
  #analysis {
    width: 30%;
  }
  </style>
  <!--<script type="text/javascript" src="js/main.js"></script>-->
  <!--<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.0/jquery.min.js"></script>-->
  <script type="text/javascript" src="js/jquery.min.js"></script>
  <script type="text/javascript" src="js/jquery.sparkline.min.js"></script>
  <script type="text/javascript">
    /*
      year
        month
          day
            activity
              food|exercise





    */
    $(function(){
      //on key release, re-scan entire

      var delay = (function(){
        var timer = 0;
        return function(callback, ms){
          clearTimeout (timer);
          timer = setTimeout(callback, ms);
        };
      })();

      $('#input').keyup(function() {
        delay(scan, 200);
      });

      var scasn = function(){
        //$("#input").html($('#input').html().replace(/<div>/gi,'<br>').replace(/<\/div>/gi,''));
        $('#processed').text($('#input').html())
      }

      var scan = function() {
        console.log('scanning!')
        $('#processed').html("")
        // categorize

        newYear = function(a){
          return "(year: "+a+")"
        }
        newMonth = function(a){
          return "(month: "+a[0]+")"
        }
        newActivity = function(a){
          return "(activity: "+a+")"
        }
        newDay = function(a){
          return "(day: "+a+")"
        }
        newFood = function(a){
          return "(food: ("+
              " name: "+a[3]+
              " quantity: "+a[1]+
              " unit:"+a[2]+
              "))"
        }
        newExercise = function(a){
          return "(exercise: ("+
              " name: "+a[4]+
              " weight: "+a[1]+
              " unit: "+"lbs"+
              " reps: "+a[2]+
              " sets: "+a[3]+
            "))"
        }
        newWeight = function(a){
          return "(weight: "+a[1]+" unit: "+a[2]+")"
        }

        regex_matches = {
          "^[0-9]{4}$": newYear
          ,"^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)[a-zA-Z]+$": newMonth
          ,"^[a-zA-Z]+$": newActivity
          ,"^[0-9]{2}$": newDay
          ,"^([0-9\.]+)([a-zA-Z]*) ([a-zA-Z -]+)$": newFood
          ,"^([0-9]+)x([0-9]+)x([0-9]) ([a-zA-Z]+)$": newExercise
          ,"^([0-9]+)(lb|kg)": newWeight
        }

        $("#input div").each(function(){
          for(var regex in regex_matches){
            if(m = $(this).text().match(RegExp(regex,"i"))){
              $("#processed").append((regex_matches[regex])(m))
              break;
            } 
          }
          $("#processed").append("<br />")
        });
      }

      

      // analysis

      analysis = "10/08/12 100g\n10/08/12 100g"

      $("#analysis").append(analysis)


      // sparklines

      //http://omnipotent.net/jquery.sparkline/#s-docs

      charts = ["weight","food","calories","carbs","derps","squat","press","bench","dead"]

      for(chart in charts){
        $("#charts").append(charts[chart])
        spark = $("<span></span>")
        $("#charts").append(spark)
        spark.sparkline([Math.random(), Math.random(), Math.random(), Math.random(), Math.random(), Math.random()],{type: 'bar'})
        $("#charts").append(Math.floor(100*Math.random())+"<br/>")

      }

    });
  </script>
</head>
<body>
<div id="input" class="space editable" contentEditable="true"><div><br/></div></div>
<div id="processed" class="space" ></div>
<div id="analysis" class="space" ></div>
<div id="charts" class="space" ></div>
</body>
</html>